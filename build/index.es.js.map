{"version":3,"file":"index.es.js","sources":["../src/index.ts"],"sourcesContent":["import {\n  ConsumerOptions,\n  ConsumerResponse,\n  createConsumer,\n  PayloadHeaders\n} from '@runhare/node'\nimport { NextApiRequest, NextApiResponse } from 'next'\n\nconst consumer = <T, K extends keyof T = keyof T>(\n  events: (keyof T)[],\n  sendKey: string,\n  consumerHandler: (\n    event: K,\n    payload: T[K],\n    headers: any\n  ) => Promise<ConsumerResponse>,\n  options?: ConsumerOptions\n) => {\n  const consumer = createConsumer<T>(sendKey, options)\n  const handler = consumer.createHandler(events, consumerHandler)\n\n  return async (req: NextApiRequest, res: NextApiResponse) => {\n    const response = await handler(req.body, req.headers as PayloadHeaders)\n\n    if (response.result === 'fail') {\n      return res.status(500).send({ error: response.error })\n    }\n\n    return res.status(204).end()\n  }\n}\n\nexport default consumer\n"],"names":["events","sendKey","consumerHandler","options","handler","createConsumer","createHandler","async","req","res","response","body","headers","result","status","send","error","end"],"mappings":"6DAQiB,CACfA,EACAC,EACAC,EAKAC,KAEA,MACMC,EADWC,EAAkBJ,EAASE,GACnBG,cAAcN,EAAQE,GAE/C,OAAOK,MAAOC,EAAqBC,KACjC,MAAMC,QAAiBN,EAAQI,EAAIG,KAAMH,EAAII,SAE7C,MAAwB,SAApBF,EAASG,OACJJ,EAAIK,OAAO,KAAKC,KAAK,CAAEC,MAAON,EAASM,QAGzCP,EAAIK,OAAO,KAAKG"}