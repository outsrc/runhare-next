{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import {\n  ConsumerOptions,\n  ConsumerResponse,\n  createConsumer,\n  PayloadHeaders\n} from '@runhare/node'\nimport { NextApiRequest, NextApiResponse } from 'next'\n\nconst consumer = <T, K extends keyof T = keyof T>(\n  events: (keyof T)[],\n  sendKey: string,\n  consumerHandler: (\n    event: K,\n    payload: T[K],\n    headers: any\n  ) => Promise<ConsumerResponse>,\n  options?: ConsumerOptions\n) => {\n  const consumer = createConsumer<T>(sendKey, options)\n  const handler = consumer.createHandler(events, consumerHandler)\n\n  return async (req: NextApiRequest, res: NextApiResponse) => {\n    if (req.method === 'GET') {\n      return res.json({ status: 'ok', stack: 'nextjs' })\n    }\n\n    const response = await handler(req.body, req.headers as PayloadHeaders)\n\n    if (response.result === 'fail') {\n      return res.status(500).send({ error: response.error })\n    }\n\n    return res.status(204).end()\n  }\n}\n\nexport default consumer\n"],"names":["events","sendKey","consumerHandler","options","handler","createConsumer","createHandler","async","req","res","method","json","status","stack","response","body","headers","result","send","error","end"],"mappings":"mHAQiB,CACfA,EACAC,EACAC,EAKAC,KAEA,MACMC,EADWC,iBAAkBJ,EAASE,GACnBG,cAAcN,EAAQE,GAE/C,OAAOK,MAAOC,EAAqBC,KACjC,GAAmB,QAAfD,EAAIE,OACN,OAAOD,EAAIE,KAAK,CAAEC,OAAQ,KAAMC,MAAO,WAGzC,MAAMC,QAAiBV,EAAQI,EAAIO,KAAMP,EAAIQ,SAE7C,MAAwB,SAApBF,EAASG,OACJR,EAAIG,OAAO,KAAKM,KAAK,CAAEC,MAAOL,EAASK,QAGzCV,EAAIG,OAAO,KAAKQ"}